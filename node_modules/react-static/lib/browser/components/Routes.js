"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _react = _interopRequireWildcard(require("react"));

var _2 = require("..");

var _useStaticInfo = require("../hooks/useStaticInfo");

var _useRoutePath = require("../hooks/useRoutePath");

//

/**
 *
 * @param {string} path
 * @returns {React.ComponentType<{}> | false}
 */
function getTemplateForPath(path) {
  var is404 = path === '404';
  var Comp = _2.templatesByPath[path] || false;

  if (!Comp && _2.templateErrorByPath[path]) {
    is404 = true;
    Comp = _2.templatesByPath['404'] || false;
  }

  return {
    is404: is404,
    Comp: Comp
  };
}
/**
 *
 *
 * @param {string} path
 * @returns {React.ReactNode | false}
 */


function getComponentForPath(path) {
  var _getTemplateForPath = getTemplateForPath(path),
      Comp = _getTemplateForPath.Comp,
      is404 = _getTemplateForPath.is404;

  if (is404 || !Comp) {
    return false;
  }

  return _react["default"].createElement(Comp, {
    is404: is404
  });
}

var RoutesInner = function RoutesInner(_ref) {
  var routePath = _ref.routePath,
      renderFn = _ref.render;
  // Let the user specify a manual routePath.
  // This is useful for animations where multiple routes
  // might be rendered simultaneously
  var staticInfo = (0, _useStaticInfo.useStaticInfo)(); // eslint-disable-next-line

  var _useState = (0, _react.useState)(0),
      _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
      _ = _useState2[0],
      setCount = _useState2[1]; // If in production, make sure the staticInfo is ingested into the
  // cache


  (0, _react.useState)(function () {
    // useState's initializer will only fire once per component instance,
    // and it will fire during the first render (unlike an effect, which
    // only fires after the first render). Think of it like a constructor call.
    if (process.env.REACT_STATIC_ENV === 'production' && staticInfo) {
      var path = staticInfo.path,
          sharedData = staticInfo.sharedData,
          sharedHashesByProp = staticInfo.sharedHashesByProp,
          template = staticInfo.template; // Hydrate routeInfoByPath with the embedded routeInfo

      _2.routeInfoByPath[path] = staticInfo; // Hydrate sharedDataByHash with the embedded routeInfo

      Object.keys(sharedHashesByProp).forEach(function (propKey) {
        _2.sharedDataByHash[sharedHashesByProp[propKey]] = sharedData[propKey];
      }); // In SRR and production, synchronously register the template for the
      // initial path

      (0, _2.registerTemplateForPath)(path, template);
    }
  });
  (0, _react.useEffect)(function () {
    return (0, _2.onReloadTemplates)(function () {
      setCount(function (old) {
        return old + 1;
      });
    });
  }); // If SSR, force the routePath to be the statically exported one

  if (typeof document === 'undefined') {
    routePath = staticInfo.path;
  } else if (!routePath) {
    // If a routePath is still not defined in the browser,
    // use the window location as the defualt
    routePath = decodeURIComponent(window.location.href);
  }

  routePath = (0, _useRoutePath.useRoutePath)(routePath); // Try and get the template

  var _getTemplateForPath2 = getTemplateForPath(routePath),
      Comp = _getTemplateForPath2.Comp,
      is404 = _getTemplateForPath2.is404;

  if (!Comp) {
    if (is404) {
      throw new Error('Neither the page template or 404 template could be found. This means something is terribly wrong. Please, file an issue!');
    } // Suspend while we fetch the resource


    throw Promise.all([new Promise(function (resolve) {
      return setTimeout(resolve, 500);
    }), (0, _2.prefetch)(routePath, {
      priority: true
    })]);
  }

  return _react["default"].createElement(_useRoutePath.routePathContext.Provider, {
    value: routePath
  }, renderFn ? renderFn({
    routePath: routePath,
    getComponentForPath: getComponentForPath
  }) : _react["default"].createElement(Comp, {
    is404: is404
  }));
};

var Routes = function Routes(_ref2) {
  var originalProps = (0, _extends2["default"])({}, _ref2);
  // Once a routePath goes into the Routes component,
  // useRoutePath must ALWAYS return the routePath used
  // in its parent, so we pass it down as context
  // Get the Routes hook
  var CompWrapper = (0, _react.useMemo)(function () {
    return _2.plugins.Routes(function (props) {
      return _react["default"].createElement(RoutesInner, props);
    });
  }, [_2.plugins]); // Pass all props so that plugins can use it

  return _react["default"].createElement(CompWrapper, originalProps);
};

var _default = Routes;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9icm93c2VyL2NvbXBvbmVudHMvUm91dGVzLmpzIl0sIm5hbWVzIjpbImdldFRlbXBsYXRlRm9yUGF0aCIsInBhdGgiLCJpczQwNCIsIkNvbXAiLCJ0ZW1wbGF0ZXNCeVBhdGgiLCJ0ZW1wbGF0ZUVycm9yQnlQYXRoIiwiZ2V0Q29tcG9uZW50Rm9yUGF0aCIsIlJlYWN0IiwiY3JlYXRlRWxlbWVudCIsIlJvdXRlc0lubmVyIiwicm91dGVQYXRoIiwicmVuZGVyRm4iLCJyZW5kZXIiLCJzdGF0aWNJbmZvIiwiXyIsInNldENvdW50IiwicHJvY2VzcyIsImVudiIsIlJFQUNUX1NUQVRJQ19FTlYiLCJzaGFyZWREYXRhIiwic2hhcmVkSGFzaGVzQnlQcm9wIiwidGVtcGxhdGUiLCJyb3V0ZUluZm9CeVBhdGgiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsInByb3BLZXkiLCJzaGFyZWREYXRhQnlIYXNoIiwib2xkIiwiZG9jdW1lbnQiLCJkZWNvZGVVUklDb21wb25lbnQiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImhyZWYiLCJFcnJvciIsIlByb21pc2UiLCJhbGwiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsInByaW9yaXR5IiwiUm91dGVzIiwib3JpZ2luYWxQcm9wcyIsIkNvbXBXcmFwcGVyIiwicGx1Z2lucyIsInByb3BzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFFQTs7QUFVQTs7QUFDQTs7QUFaQTs7QUFjQTs7Ozs7QUFLQSxTQUFTQSxrQkFBVCxDQUE0QkMsSUFBNUIsRUFBa0M7QUFDaEMsTUFBSUMsS0FBSyxHQUFHRCxJQUFJLEtBQUssS0FBckI7QUFDQSxNQUFJRSxJQUFJLEdBQUdDLG1CQUFnQkgsSUFBaEIsS0FBeUIsS0FBcEM7O0FBRUEsTUFBSSxDQUFDRSxJQUFELElBQVNFLHVCQUFvQkosSUFBcEIsQ0FBYixFQUF3QztBQUN0Q0MsSUFBQUEsS0FBSyxHQUFHLElBQVI7QUFDQUMsSUFBQUEsSUFB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QURJLENBQU47QUFHRCxLQUxRLENBTVQ7OztBQUNBLFVBQU1DLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLENBQ2hCLElBQUlELE9BQUosQ0FBWSxVQUFBRSxPQUFPO0FBQUEsYUFBSUMsVUFBVSxDQUFDRCxPQUFELEVBQVUsR0FBVixDQUFkO0FBQUEsS0FBbkIsQ0FEZ0IsRUFFaEIsaUJBQVMzQixTQUFULEVBQW9CO0FBQUU2QixNQUFBQSxRQUFRLEVBQUU7QUFBWixLQUFwQixDQUZnQixDQUFaLENBQU47QUFJRDs7QUFFRCxTQUNFLGdDQUFDLDhCQUFELENBQWtCLFFBQWxCO0FBQTJCLElBQUEsS0FBSyxFQUFFN0I7QUFBbEMsS0FDR0MsUUFBUSxHQUNQQSxRQUFRLENBQUM7QUFBRUQsSUFBQUEsU0FBUyxFQUFUQSxTQUFGO0FBQWFKLElBQUFBLG1CQUFtQixFQUFuQkE7QUFBYixHQUFELENBREQsR0FHUCxnQ0FBQyxJQUFEO0FBQU0sSUFBQSxLQUFLLEVBQUVKO0FBQWIsSUFKSixDQURGO0FBU0QsQ0ExRUQ7O0FBNEVBLElBQU1zQyxNQUFNLEdBQUcsU0FBVEEsTUFBUyxRQUEwQjtBQUFBLE1BQXBCQyxhQUFvQjtBQUN2QztBQUNBO0FBQ0E7QUFFQTtBQUNBLE1BQU1DLFdBQVcsR0FBRyxvQkFDbEI7QUFBQSxXQUFNQyxXQUFRSCxNQUFSLENBQWUsVUFBQUksS0FBSztBQUFBLGFBQUksZ0NBQUMsV0FBRCxFQUFpQkEsS0FBakIsQ0FBSjtBQUFBLEtBQXBCLENBQU47QUFBQSxHQURrQixFQUVsQixDQUFDRCxVQUFELENBRmtCLENBQXBCLENBTnVDLENBV3ZDOztBQUNBLFNBQU8sZ0NBQUMsV0FBRCxFQUFpQkYsYUFBakIsQ0FBUDtBQUNELENBYkQ7O2VBZWVELE0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlU3RhdGUsIHVzZU1lbW8sIHVzZUVmZmVjdCB9IGZyb20gJ3JlYWN0J1xyXG4vL1xyXG5pbXBvcnQge1xyXG4gIHRlbXBsYXRlc0J5UGF0aCxcclxuICB0ZW1wbGF0ZUVycm9yQnlQYXRoLFxyXG4gIHJvdXRlSW5mb0J5UGF0aCxcclxuICBzaGFyZWREYXRhQnlIYXNoLFxyXG4gIHJlZ2lzdGVyVGVtcGxhdGVGb3JQYXRoLFxyXG4gIHByZWZldGNoLFxyXG4gIHBsdWdpbnMsXHJcbiAgb25SZWxvYWRUZW1wbGF0ZXMsXHJcbn0gZnJvbSAnLi4nXHJcbmltcG9ydCB7IHVzZVN0YXRpY0luZm8gfSBmcm9tICcuLi9ob29rcy91c2VTdGF0aWNJbmZvJ1xyXG5pbXBvcnQgeyByb3V0ZVBhdGhDb250ZXh0LCB1c2VSb3V0ZVBhdGggfSBmcm9tICcuLi9ob29rcy91c2VSb3V0ZVBhdGgnXHJcblxyXG4vKipcclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHBhdGhcclxuICogQHJldHVybnMge1JlYWN0LkNvbXBvbmVudFR5cGU8e30+IHwgZmFsc2V9XHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRUZW1wbGF0ZUZvclBhdGgocGF0aCkge1xyXG4gIGxldCBpczQwNCA9IHBhdGggPT09ICc0MDQnXHJcbiAgbGV0IENvbXAgPSB0ZW1wbGF0ZXNCeVBhdGhbcGF0aF0gfHwgZmFsc2VcclxuXHJcbiAgaWYgKCFDb21wICYmIHRlbXBsYXRlRXJyb3JCeVBhdGhbcGF0aF0pIHtcclxuICAgIGlzNDA0ID0gdHJ1ZVxyXG4gICAgQ29tcCA9IHRlbXBsYXRlc0J5UGF0aFsnNDA0J10gfHwgZmFsc2VcclxuICB9XHJcblxyXG4gIHJldHVybiB7IGlzNDA0LCBDb21wIH1cclxufVxyXG5cclxuLyoqXHJcbiAqXHJcbiAqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoXHJcbiAqIEByZXR1cm5zIHtSZWFjdC5SZWFjdE5vZGUgfCBmYWxzZX1cclxuICovXHJcbmZ1bmN0aW9uIGdldENvbXBvbmVudEZvclBhdGgocGF0aCkge1xyXG4gIGNvbnN0IHsgQ29tcCwgaXM0MDQgfSA9IGdldFRlbXBsYXRlRm9yUGF0aChwYXRoKVxyXG4gIGlmIChpczQwNCB8fCAhQ29tcCkge1xyXG4gICAgcmV0dXJuIGZhbHNlXHJcbiAgfVxyXG5cclxuICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChDb21wLCB7IGlzNDA0IH0pXHJcbn1cclxuXHJcbmNvbnN0IFJvdXRlc0lubmVyID0gKHsgcm91dGVQYXRoLCByZW5kZXI6IHJlbmRlckZuIH0pID0+IHtcclxuICAvLyBMZXQgdGhlIHVzZXIgc3BlY2lmeSBhIG1hbnVhbCByb3V0ZVBhdGguXHJcbiAgLy8gVGhpcyBpcyB1c2VmdWwgZm9yIGFuaW1hdGlvbnMgd2hlcmUgbXVsdGlwbGUgcm91dGVzXHJcbiAgLy8gbWlnaHQgYmUgcmVuZGVyZWQgc2ltdWx0YW5lb3VzbHlcclxuXHJcbiAgY29uc3Qgc3RhdGljSW5mbyA9IHVzZVN0YXRpY0luZm8oKVxyXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxyXG4gIGNvbnN0IFtfLCBzZXRDb3VudF0gPSB1c2VTdGF0ZSgwKVxyXG5cclxuICAvLyBJZiBpbiBwcm9kdWN0aW9uLCBtYWtlIHN1cmUgdGhlIHN0YXRpY0luZm8gaXMgaW5nZXN0ZWQgaW50byB0aGVcclxuICAvLyBjYWNoZVxyXG4gIHVzZVN0YXRlKCgpID0+IHtcclxuICAgIC8vIHVzZVN0YXRlJ3MgaW5pdGlhbGl6ZXIgd2lsbCBvbmx5IGZpcmUgb25jZSBwZXIgY29tcG9uZW50IGluc3RhbmNlLFxyXG4gICAgLy8gYW5kIGl0IHdpbGwgZmlyZSBkdXJpbmcgdGhlIGZpcnN0IHJlbmRlciAodW5saWtlIGFuIGVmZmVjdCwgd2hpY2hcclxuICAgIC8vIG9ubHkgZmlyZXMgYWZ0ZXIgdGhlIGZpcnN0IHJlbmRlcikuIFRoaW5rIG9mIGl0IGxpa2UgYSBjb25zdHJ1Y3RvciBjYWxsLlxyXG4gICAgaWYgKHByb2Nlc3MuZW52LlJFQUNUX1NUQVRJQ19FTlYgPT09ICdwcm9kdWN0aW9uJyAmJiBzdGF0aWNJbmZvKSB7XHJcbiAgICAgIGNvbnN0IHsgcGF0aCwgc2hhcmVkRGF0YSwgc2hhcmVkSGFzaGVzQnlQcm9wLCB0ZW1wbGF0ZSB9ID0gc3RhdGljSW5mb1xyXG5cclxuICAgICAgLy8gSHlkcmF0ZSByb3V0ZUluZm9CeVBhdGggd2l0aCB0aGUgZW1iZWRkZWQgcm91dGVJbmZvXHJcbiAgICAgIHJvdXRlSW5mb0J5UGF0aFtwYXRoXSA9IHN0YXRpY0luZm9cclxuXHJcbiAgICAgIC8vIEh5ZHJhdGUgc2hhcmVkRGF0YUJ5SGFzaCB3aXRoIHRoZSBlbWJlZGRlZCByb3V0ZUluZm9cclxuICAgICAgT2JqZWN0LmtleXMoc2hhcmVkSGFzaGVzQnlQcm9wKS5mb3JFYWNoKHByb3BLZXkgPT4ge1xyXG4gICAgICAgIHNoYXJlZERhdGFCeUhhc2hbc2hhcmVkSGFzaGVzQnlQcm9wW3Byb3BLZXldXSA9IHNoYXJlZERhdGFbcHJvcEtleV1cclxuICAgICAgfSlcclxuXHJcbiAgICAgIC8vIEluIFNSUiBhbmQgcHJvZHVjdGlvbiwgc3luY2hyb25vdXNseSByZWdpc3RlciB0aGUgdGVtcGxhdGUgZm9yIHRoZVxyXG4gICAgICAvLyBpbml0aWFsIHBhdGhcclxuICAgICAgcmVnaXN0ZXJUZW1wbGF0ZUZvclBhdGgocGF0aCwgdGVtcGxhdGUpXHJcbiAgICB9XHJcbiAgfSlcclxuXHJcbiAgdXNlRWZmZWN0KCgpID0+XHJcbiAgICBvblJlbG9hZFRlbXBsYXRlcygoKSA9PiB7XHJcbiAgICAgIHNldENvdW50KG9sZCA9PiBvbGQgKyAxKVxyXG4gICAgfSlcclxuICApXHJcblxyXG4gIC8vIElmIFNTUiwgZm9yY2UgdGhlIHJvdXRlUGF0aCB0byBiZSB0aGUgc3RhdGljYWxseSBleHBvcnRlZCBvbmVcclxuICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgcm91dGVQYXRoID0gc3RhdGljSW5mby5wYXRoXHJcbiAgfSBlbHNlIGlmICghcm91dGVQYXRoKSB7XHJcbiAgICAvLyBJZiBhIHJvdXRlUGF0aCBpcyBzdGlsbCBub3QgZGVmaW5lZCBpbiB0aGUgYnJvd3NlcixcclxuICAgIC8vIHVzZSB0aGUgd2luZG93IGxvY2F0aW9uIGFzIHRoZSBkZWZ1YWx0XHJcbiAgICByb3V0ZVBhdGggPSBkZWNvZGVVUklDb21wb25lbnQod2luZG93LmxvY2F0aW9uLmhyZWYpXHJcbiAgfVxyXG5cclxuICByb3V0ZVBhdGggPSB1c2VSb3V0ZVBhdGgocm91dGVQYXRoKVxyXG5cclxuICAvLyBUcnkgYW5kIGdldCB0aGUgdGVtcGxhdGVcclxuICBjb25zdCB7IENvbXAsIGlzNDA0IH0gPSBnZXRUZW1wbGF0ZUZvclBhdGgocm91dGVQYXRoKVxyXG5cclxuICBpZiAoIUNvbXApIHtcclxuICAgIGlmIChpczQwNCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXHJcbiAgICAgICAgJ05laXRoZXIgdGhlIHBhZ2UgdGVtcGxhdGUgb3IgNDA0IHRlbXBsYXRlIGNvdWxkIGJlIGZvdW5kLiBUaGlzIG1lYW5zIHNvbWV0aGluZyBpcyB0ZXJyaWJseSB3cm9uZy4gUGxlYXNlLCBmaWxlIGFuIGlzc3VlISdcclxuICAgICAgKVxyXG4gICAgfVxyXG4gICAgLy8gU3VzcGVuZCB3aGlsZSB3ZSBmZXRjaCB0aGUgcmVzb3VyY2VcclxuICAgIHRocm93IFByb21pc2UuYWxsKFtcclxuICAgICAgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDUwMCkpLFxyXG4gICAgICBwcmVmZXRjaChyb3V0ZVBhdGgsIHsgcHJpb3JpdHk6IHRydWUgfSksXHJcbiAgICBdKVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIChcclxuICAgIDxyb3V0ZVBhdGhDb250ZXh0LlByb3ZpZGVyIHZhbHVlPXtyb3V0ZVBhdGh9PlxyXG4gICAgICB7cmVuZGVyRm4gPyAoXHJcbiAgICAgICAgcmVuZGVyRm4oeyByb3V0ZVBhdGgsIGdldENvbXBvbmVudEZvclBhdGggfSlcclxuICAgICAgKSA6IChcclxuICAgICAgICA8Q29tcCBpczQwND17aXM0MDR9IC8+XHJcbiAgICAgICl9XHJcbiAgICA8L3JvdXRlUGF0aENvbnRleHQuUHJvdmlkZXI+XHJcbiAgKVxyXG59XHJcblxyXG5jb25zdCBSb3V0ZXMgPSAoeyAuLi5vcmlnaW5hbFByb3BzIH0pID0+IHtcclxuICAvLyBPbmNlIGEgcm91dGVQYXRoIGdvZXMgaW50byB0aGUgUm91dGVzIGNvbXBvbmVudCxcclxuICAvLyB1c2VSb3V0ZVBhdGggbXVzdCBBTFdBWVMgcmV0dXJuIHRoZSByb3V0ZVBhdGggdXNlZFxyXG4gIC8vIGluIGl0cyBwYXJlbnQsIHNvIHdlIHBhc3MgaXQgZG93biBhcyBjb250ZXh0XHJcblxyXG4gIC8vIEdldCB0aGUgUm91dGVzIGhvb2tcclxuICBjb25zdCBDb21wV3JhcHBlciA9IHVzZU1lbW8oXHJcbiAgICAoKSA9PiBwbHVnaW5zLlJvdXRlcyhwcm9wcyA9PiA8Um91dGVzSW5uZXIgey4uLnByb3BzfSAvPiksXHJcbiAgICBbcGx1Z2luc11cclxuICApXHJcblxyXG4gIC8vIFBhc3MgYWxsIHByb3BzIHNvIHRoYXQgcGx1Z2lucyBjYW4gdXNlIGl0XHJcbiAgcmV0dXJuIDxDb21wV3JhcHBlciB7Li4ub3JpZ2luYWxQcm9wc30gLz5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgUm91dGVzXHJcbiJdfQ==