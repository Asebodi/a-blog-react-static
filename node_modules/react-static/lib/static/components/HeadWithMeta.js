"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = makeHeadWithMeta;
exports.InlineStyle = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _react = _interopRequireDefault(require("react"));

var _utils = require("../../utils");

var _plugins = _interopRequireDefault(require("../plugins"));

//
// import packagejson from '../../../package.json'
// const { version } = packagejson
var REGEX_FOR_STYLE_TAG = /<style>|<\/style>/gi;

var InlineStyle = function InlineStyle(_ref) {
  var clientCss = _ref.clientCss;
  return _react["default"].createElement("style", {
    key: "clientCss",
    type: "text/css",
    dangerouslySetInnerHTML: {
      __html: clientCss.toString().replace(REGEX_FOR_STYLE_TAG, '')
    }
  });
};

exports.InlineStyle = InlineStyle;

function makeHeadWithMeta(_x) {
  return _makeHeadWithMeta.apply(this, arguments);
}

function _makeHeadWithMeta() {
  _makeHeadWithMeta = (0, _asyncToGenerator2["default"])(
  /*#__PURE__*/
  _regenerator["default"].mark(function _callee(state) {
    var head, route, clientScripts, config, clientStyleSheets, clientCss, pluginHeads;
    return _regenerator["default"].wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            head = state.head, route = state.route, clientScripts = state.clientScripts, config = state.config, clientStyleSheets = state.clientStyleSheets, clientCss = state.clientCss;
            _context.next = 3;
            return _plugins["default"].headElements([], state);

          case 3:
            pluginHeads = _context.sent;
            return _context.abrupt("return", function (_ref2) {
              var children = _ref2.children,
                  rest = (0, _objectWithoutProperties2["default"])(_ref2, ["children"]);
              var renderLinkCSS = !route.redirect && !config.inlineCss;
              var useHelmetTitle = head.title && head.title[0] && head.title[0].props.children !== '';

              var childrenArray = _react["default"].Children.toArray(children);

              if (useHelmetTitle) {
                head.title[0] = _react["default"].cloneElement(head.title[0], {
                  key: 'title'
                });
                childrenArray = childrenArray.filter(function (child) {
                  if (child.type === 'title') {
                    // Filter out the title of the Document in static.config.js
                    // if there is a helmet title on this route
                    return false;
                  }

                  return true;
                });
              }

              var childrenCSS = childrenArray.filter(function (child) {
                if (child.type === 'link' && child.props && child.props.rel === 'stylesheet') {
                  return true;
                }

                if (child.type === 'style') {
                  return true;
                }

                return false;
              });
              var childrenJS = childrenArray.filter(function (child) {
                return child.type === 'script';
              });
              childrenArray = childrenArray.filter(function (child) {
                if (child.type === 'link' && child.props && child.props.rel === 'stylesheet') {
                  return false;
                }

                if (child.type === 'style') {
                  return false;
                }

                if (child.type === 'script') {
                  return false;
                }

                return true;
              });
              return _react["default"].createElement("head", rest, _react["default"].createElement("meta", {
                name: "generator",
                content: "React Static"
              }), head.base, useHelmetTitle && head.title, head.meta, childrenJS, !route.redirect && clientScripts.map(function (script) {
                return _react["default"].createElement("link", {
                  key: "clientScript_".concat(script),
                  rel: "preload",
                  as: "script",
                  href: (0, _utils.makePathAbsolute)((0, _utils.pathJoin)(process.env.REACT_STATIC_ASSETS_PATH, script))
                });
              }), childrenCSS, renderLinkCSS && clientStyleSheets.reduce(function (memo, styleSheet) {
                var href = (0, _utils.makePathAbsolute)((0, _utils.pathJoin)(process.env.REACT_STATIC_ASSETS_PATH, styleSheet));
                return [].concat((0, _toConsumableArray2["default"])(memo), [_react["default"].createElement("link", {
                  key: "clientStyleSheetPreload_".concat(styleSheet),
                  rel: "preload",
                  as: "style",
                  href: href
                }), _react["default"].createElement("link", {
                  key: "clientStyleSheet_".concat(styleSheet),
                  rel: "stylesheet",
                  href: href
                })]);
              }, []), head.link, head.noscript, head.script, config.inlineCss && _react["default"].createElement(InlineStyle, {
                clientCss: clientCss
              }), head.style, pluginHeads, childrenArray);
            });

          case 5:
          case "end":
            return _context.stop();
        }
      }
    }, _callee);
  }));
  return _makeHeadWithMeta.apply(this, arguments);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zdGF0aWMvY29tcG9uZW50cy9IZWFkV2l0aE1ldGEuanMiXSwibmFtZXMiOlsiUkVHRVhfRk9SX1NUWUxFX1RBRyIsIklubGluZVN0eWxlIiwiY2xpZW50Q3NzIiwiX19odG1sIiwidG9TdHJpbmciLCJyZXBsYWNlIiwibWFrZUhlYWRXaXRoTWV0YSIsInN0YXRlIiwiaGVhZCIsInJvdXRlIiwiY2xpZW50U2NyaXB0cyIsImNvbmZpZyIsImNsaWVudFN0eWxlU2hlZXRzIiwicGx1Z2lucyIsImhlYWRFbGVtZW50cyIsInBsdWdpbkhlYWRzIiwiY2hpbGRyZW4iLCJyZXN0IiwicmVuZGVyTGlua0NTUyIsInJlZGlyZWN0IiwiaW5saW5lQ3NzIiwidXNlSGVsbWV0VGl0bGUiLCJ0aXRsZSIsInByb3BzIiwiY2hpbGRyZW5BcnJheSIsIlJlYWN0IiwiQ2hpbGRyZW4iLCJ0b0FycmF5IiwiY2xvbmVFbGVtZW50Iiwia2V5IiwiZmlsdGVyIiwiY2hpbGQiLCJ0eXBlIiwiY2hpbGRyZW5DU1MiLCJyZWwiLCJjaGlsZHJlbkpTIiwiYmFzZSIsIm1ldGEiLCJtYXAiLCJzY3JpcHQiLCJwcm9jZXNzIiwiZW52IiwiUkVBQ1RfU1RBVElDX0FTU0VUU19QQVRIIiwicmVkdWNlIiwibWVtbyIsInN0eWxlU2hlZXQiLCJocmVmIiwibGluayIsIm5vc2NyaXB0Iiwic3R5bGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUVBOztBQUNBOztBQUZBO0FBR0E7QUFFQTtBQUVBLElBQU1BLG1CQUFtQixHQUFHLHFCQUE1Qjs7QUFFTyxJQUFNQyxXQUFXLEdBQUcsU0FBZEEsV0FBYztBQUFBLE1BQUdDLFNBQUgsUUFBR0EsU0FBSDtBQUFBLFNBQ3pCO0FBQ0UsSUFBQSxHQUFHLEVBQUMsV0FETjtBQUVFLElBQUEsSUFBSSxFQUFDLFVBRlA7QUFHRSxJQUFBLHVCQUF1QixFQUFFO0FBQ3ZCQyxNQUFBQSxNQUFNLEVBQUVELFNBQVMs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RCxVQUF0QixDQURMO0FBRUUsa0JBQUEsR0FBRyxFQUFDLFlBRk47QUFHRSxrQkFBQSxJQUFJLEVBQUVDO0FBSFIsa0JBUkY7QUFjRCxlQW5CRCxFQW1CRyxFQW5CSCxDQW5CSixFQXVDR3RDLElBQUksQ0FBQ3VDLElBdkNSLEVBd0NHdkMsSUFBSSxDQUFDd0MsUUF4Q1IsRUF5Q0d4QyxJQUFJLENBQUMrQixNQXpDUixFQTBDRzVCLE1BQU0sQ0FBQ1MsU0FBUCxJQUFvQixnQ0FBQyxXQUFEO0FBQWEsZ0JBQUEsU0FBUyxFQUFFbEI7QUFBeEIsZ0JBMUN2QixFQTJDR00sSUFBSSxDQUFDeUMsS0EzQ1IsRUE0Q0dsQyxXQTVDSCxFQTZDR1MsYUE3Q0gsQ0FERjtBQWlERCxhQWpIWTs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxHIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0J1xyXG4vL1xyXG5pbXBvcnQgeyBwYXRoSm9pbiwgbWFrZVBhdGhBYnNvbHV0ZSB9IGZyb20gJy4uLy4uL3V0aWxzJ1xyXG5pbXBvcnQgcGx1Z2lucyBmcm9tICcuLi9wbHVnaW5zJ1xyXG4vLyBpbXBvcnQgcGFja2FnZWpzb24gZnJvbSAnLi4vLi4vLi4vcGFja2FnZS5qc29uJ1xyXG5cclxuLy8gY29uc3QgeyB2ZXJzaW9uIH0gPSBwYWNrYWdlanNvblxyXG5cclxuY29uc3QgUkVHRVhfRk9SX1NUWUxFX1RBRyA9IC88c3R5bGU+fDxcXC9zdHlsZT4vZ2lcclxuXHJcbmV4cG9ydCBjb25zdCBJbmxpbmVTdHlsZSA9ICh7IGNsaWVudENzcyB9KSA9PiAoXHJcbiAgPHN0eWxlXHJcbiAgICBrZXk9XCJjbGllbnRDc3NcIlxyXG4gICAgdHlwZT1cInRleHQvY3NzXCJcclxuICAgIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MPXt7XHJcbiAgICAgIF9faHRtbDogY2xpZW50Q3NzLnRvU3RyaW5nKCkucmVwbGFjZShSRUdFWF9GT1JfU1RZTEVfVEFHLCAnJyksXHJcbiAgICB9fVxyXG4gIC8+XHJcbilcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIG1ha2VIZWFkV2l0aE1ldGEoc3RhdGUpIHtcclxuICBjb25zdCB7XHJcbiAgICBoZWFkLFxyXG4gICAgcm91dGUsXHJcbiAgICBjbGllbnRTY3JpcHRzLFxyXG4gICAgY29uZmlnLFxyXG4gICAgY2xpZW50U3R5bGVTaGVldHMsXHJcbiAgICBjbGllbnRDc3MsXHJcbiAgfSA9IHN0YXRlXHJcblxyXG4gIGNvbnN0IHBsdWdpbkhlYWRzID0gYXdhaXQgcGx1Z2lucy5oZWFkRWxlbWVudHMoW10sIHN0YXRlKVxyXG5cclxuICByZXR1cm4gKHsgY2hpbGRyZW4sIC4uLnJlc3QgfSkgPT4ge1xyXG4gICAgY29uc3QgcmVuZGVyTGlua0NTUyA9ICFyb3V0ZS5yZWRpcmVjdCAmJiAhY29uZmlnLmlubGluZUNzc1xyXG5cclxuICAgIGNvbnN0IHVzZUhlbG1ldFRpdGxlID1cclxuICAgICAgaGVhZC50aXRsZSAmJiBoZWFkLnRpdGxlWzBdICYmIGhlYWQudGl0bGVbMF0ucHJvcHMuY2hpbGRyZW4gIT09ICcnXHJcblxyXG4gICAgbGV0IGNoaWxkcmVuQXJyYXkgPSBSZWFjdC5DaGlsZHJlbi50b0FycmF5KGNoaWxkcmVuKVxyXG5cclxuICAgIGlmICh1c2VIZWxtZXRUaXRsZSkge1xyXG4gICAgICBoZWFkLnRpdGxlWzBdID0gUmVhY3QuY2xvbmVFbGVtZW50KGhlYWQudGl0bGVbMF0sIHsga2V5OiAndGl0bGUnIH0pXHJcbiAgICAgIGNoaWxkcmVuQXJyYXkgPSBjaGlsZHJlbkFycmF5LmZpbHRlcihjaGlsZCA9PiB7XHJcbiAgICAgICAgaWYgKGNoaWxkLnR5cGUgPT09ICd0aXRsZScpIHtcclxuICAgICAgICAgIC8vIEZpbHRlciBvdXQgdGhlIHRpdGxlIG9mIHRoZSBEb2N1bWVudCBpbiBzdGF0aWMuY29uZmlnLmpzXHJcbiAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBhIGhlbG1ldCB0aXRsZSBvbiB0aGlzIHJvdXRlXHJcbiAgICAgICAgICByZXR1cm4gZmFsc2VcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRydWVcclxuICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjaGlsZHJlbkNTUyA9IGNoaWxkcmVuQXJyYXkuZmlsdGVyKGNoaWxkID0+IHtcclxuICAgICAgaWYgKFxyXG4gICAgICAgIGNoaWxkLnR5cGUgPT09ICdsaW5rJyAmJlxyXG4gICAgICAgIGNoaWxkLnByb3BzICYmXHJcbiAgICAgICAgY2hpbGQucHJvcHMucmVsID09PSAnc3R5bGVzaGVldCdcclxuICAgICAgKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWVcclxuICAgICAgfVxyXG4gICAgICBpZiAoY2hpbGQudHlwZSA9PT0gJ3N0eWxlJykge1xyXG4gICAgICAgIHJldHVybiB0cnVlXHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICB9KVxyXG5cclxuICAgIGNvbnN0IGNoaWxkcmVuSlMgPSBjaGlsZHJlbkFycmF5LmZpbHRlcihjaGlsZCA9PiBjaGlsZC50eXBlID09PSAnc2NyaXB0JylcclxuICAgIGNoaWxkcmVuQXJyYXkgPSBjaGlsZHJlbkFycmF5LmZpbHRlcihjaGlsZCA9PiB7XHJcbiAgICAgIGlmIChcclxuICAgICAgICBjaGlsZC50eXBlID09PSAnbGluaycgJiZcclxuICAgICAgICBjaGlsZC5wcm9wcyAmJlxyXG4gICAgICAgIGNoaWxkLnByb3BzLnJlbCA9PT0gJ3N0eWxlc2hlZXQnXHJcbiAgICAgICkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZVxyXG4gICAgICB9XHJcbiAgICAgIGlmIChjaGlsZC50eXBlID09PSAnc3R5bGUnKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICAgIH1cclxuICAgICAgaWYgKGNoaWxkLnR5cGUgPT09ICdzY3JpcHQnKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHRydWVcclxuICAgIH0pXHJcblxyXG4gICAgcmV0dXJuIChcclxuICAgICAgPGhlYWQgey4uLnJlc3R9PlxyXG4gICAgICAgIDxtZXRhIG5hbWU9XCJnZW5lcmF0b3JcIiBjb250ZW50PVwiUmVhY3QgU3RhdGljXCIgLz5cclxuICAgICAgICB7aGVhZC5iYXNlfVxyXG4gICAgICAgIHt1c2VIZWxtZXRUaXRsZSAmJiBoZWFkLnRpdGxlfVxyXG4gICAgICAgIHtoZWFkLm1ldGF9XHJcbiAgICAgICAge2NoaWxkcmVuSlN9XHJcbiAgICAgICAgeyFyb3V0ZS5yZWRpcmVjdCAmJlxyXG4gICAgICAgICAgY2xpZW50U2NyaXB0cy5tYXAoc2NyaXB0ID0+IChcclxuICAgICAgICAgICAgPGxpbmtcclxuICAgICAgICAgICAgICBrZXk9e2BjbGllbnRTY3JpcHRfJHtzY3JpcHR9YH1cclxuICAgICAgICAgICAgICByZWw9XCJwcmVsb2FkXCJcclxuICAgICAgICAgICAgICBhcz1cInNjcmlwdFwiXHJcbiAgICAgICAgICAgICAgaHJlZj17bWFrZVBhdGhBYnNvbHV0ZShcclxuICAgICAgICAgICAgICAgIHBhdGhKb2luKHByb2Nlc3MuZW52LlJFQUNUX1NUQVRJQ19BU1NFVFNfUEFUSCwgc2NyaXB0KVxyXG4gICAgICAgICAgICAgICl9XHJcbiAgICAgICAgICAgIC8+XHJcbiAgICAgICAgICApKX1cclxuICAgICAgICB7Y2hpbGRyZW5DU1N9XHJcbiAgICAgICAge3JlbmRlckxpbmtDU1MgJiZcclxuICAgICAgICAgIGNsaWVudFN0eWxlU2hlZXRzLnJlZHVjZSgobWVtbywgc3R5bGVTaGVldCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBocmVmID0gbWFrZVBhdGhBYnNvbHV0ZShcclxuICAgICAgICAgICAgICBwYXRoSm9pbihwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfQVNTRVRTX1BBVEgsIHN0eWxlU2hlZXQpXHJcbiAgICAgICAgICAgIClcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBbXHJcbiAgICAgICAgICAgICAgLi4ubWVtbyxcclxuICAgICAgICAgICAgICA8bGlua1xyXG4gICAgICAgICAgICAgICAga2V5PXtgY2xpZW50U3R5bGVTaGVldFByZWxvYWRfJHtzdHlsZVNoZWV0fWB9XHJcbiAgICAgICAgICAgICAgICByZWw9XCJwcmVsb2FkXCJcclxuICAgICAgICAgICAgICAgIGFzPVwic3R5bGVcIlxyXG4gICAgICAgICAgICAgICAgaHJlZj17aHJlZn1cclxuICAgICAgICAgICAgICAvPixcclxuICAgICAgICAgICAgICA8bGlua1xyXG4gICAgICAgICAgICAgICAga2V5PXtgY2xpZW50U3R5bGVTaGVldF8ke3N0eWxlU2hlZXR9YH1cclxuICAgICAgICAgICAgICAgIHJlbD1cInN0eWxlc2hlZXRcIlxyXG4gICAgICAgICAgICAgICAgaHJlZj17aHJlZn1cclxuICAgICAgICAgICAgICAvPixcclxuICAgICAgICAgICAgXVxyXG4gICAgICAgICAgfSwgW10pfVxyXG4gICAgICAgIHtoZWFkLmxpbmt9XHJcbiAgICAgICAge2hlYWQubm9zY3JpcHR9XHJcbiAgICAgICAge2hlYWQuc2NyaXB0fVxyXG4gICAgICAgIHtjb25maWcuaW5saW5lQ3NzICYmIDxJbmxpbmVTdHlsZSBjbGllbnRDc3M9e2NsaWVudENzc30gLz59XHJcbiAgICAgICAge2hlYWQuc3R5bGV9XHJcbiAgICAgICAge3BsdWdpbkhlYWRzfVxyXG4gICAgICAgIHtjaGlsZHJlbkFycmF5fVxyXG4gICAgICA8L2hlYWQ+XHJcbiAgICApXHJcbiAgfVxyXG59XHJcbiJdfQ==