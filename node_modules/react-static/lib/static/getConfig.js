"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = getConfig;
exports.buildConfig = buildConfig;

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _path = _interopRequireDefault(require("path"));

var _chokidar = _interopRequireDefault(require("chokidar"));

var _resolveFrom = _interopRequireDefault(require("resolve-from"));

var _fsExtra = _interopRequireDefault(require("fs-extra"));

var _utils = require("../utils");

var _plugins = _interopRequireWildcard(require("./plugins"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

// the default static.config.js location
var defaultConfig = {};
var DEFAULT_NAME_FOR_STATIC_CONFIG_FILE = 'static.config.js';

var DEFAULT_PATH_FOR_STATIC_CONFIG = _path["default"].resolve(_path["default"].join(process.cwd(), DEFAULT_NAME_FOR_STATIC_CONFIG_FILE));

var DEFAULT_ROUTES = [{
  path: '/'
}];
var DEFAULT_ENTRY = 'index.js';
var DEFAULT_EXTENSIONS = ['.js', '.jsx']; // Retrieves the static.config.js from the current project directory

function getConfig(state) {
  var callback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function (config) {
    if (state.debug) {
      console.log('getConfig():');
      console.log(state);
    }

    return config;
  };
  var configPath = state.configPath || state.packageConfig.config || DEFAULT_PATH_FOR_STATIC_CONFIG;
  state = _objectSpread({}, state, {
    originalConfig: configPath
  });

  var resolvedPath = _path["default"].resolve(configPath);

  var noConfig = configPath === DEFAULT_PATH_FOR_STATIC_CONFIG && !resolvedPath;

  if (noConfig) {
    // last
    state = buildConfig(state, defaultConfig);
    return callback(state);
  }

  state = buildConfigFromPath(state, resolvedPath || configPath);

  if (state.stage === 'dev') {
    _chokidar["default"].watch(resolvedPath, {
      ignoreInitial: true
    }).on('all',
    /*#__PURE__*/
    (0, _asyncToGenerator2["default"])(
    /*#__PURE__*/
    _regenerator["default"].mark(function _callee() {
      return _regenerator["default"].wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              console.log('');
              console.log("Updating static.config.js");
              state = buildConfigFromPath(state, resolvedPath);
              callback(state);

            case 4:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    })));
  }

  return callback(state);
}

function buildConfigFromPath(state, configPath) {
  delete require.cache[configPath];

  var config = require(configPath)["default"];

  return buildConfig(state, config);
}

function buildConfig(state) {
  var config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  // Default Paths
  var paths = _objectSpread({
    root: _path["default"].resolve(process.cwd()),
    src: 'src',
    dist: 'dist',
    temp: 'tmp',
    buildArtifacts: 'artifacts',
    devDist: 'tmp/dev-server',
    "public": 'public',
    plugins: 'plugins',
    pages: 'src/pages',
    nodeModules: 'node_modules',
    assets: ''
  }, config.paths || {}); // Use the root to resolve all other relative paths


  var resolvePath = function resolvePath(relativePath) {
    return _path["default"].resolve(paths.root, relativePath);
  }; // Resolve and replace all pathss


  var DIST = process.env.REACT_STATIC_ENV === 'development' ? resolvePath(paths.devDist || paths.dist) : resolvePath(paths.dist);

  var ASSETS = _path["default"].resolve(DIST, paths.assets);

  paths = {
    ROOT: paths.root,
    SRC: resolvePath(paths.src),
    DIST: DIST,
    ASSETS: ASSETS,
    PLUGINS: resolvePath(paths.plugins),
    TEMP: resolvePath(paths.temp),
    ARTIFACTS: resolvePath(paths.buildArtifacts),
    PUBLIC: resolvePath(paths["public"]),
    NODE_MODULES: resolvePath(paths.nodeModules),
    EXCLUDE_MODULES: paths.excludeResolvedModules || resolvePath(paths.nodeModules),
    PACKAGE: resolvePath('package.json'),
    HTML_TEMPLATE: _path["default"].join(DIST, 'index.html'),
    STATIC_DATA: _path["default"].join(ASSETS, 'staticData') // siteRoot, basePath, publicPath, and assetPath resolution

  };
  var siteRoot = '';
  var basePath = '';
  var assetsPath = '';

  if (process.env.REACT_STATIC_ENV === 'development') {
    basePath = (0, _utils.cleanSlashes)(config.devBasePath);
    assetsPath = config.devAssetsPath || paths.assets || assetsPath;
  } else if (state.staging) {
    siteRoot = (0, _utils.cutPathToRoot)(config.stagingSiteRoot || '/', '$1');
    basePath = (0, _utils.cleanSlashes)(config.stagingBasePath);
    assetsPath = config.stagingAssetsPath || paths.assets || assetsPath;
  } else {
    siteRoot = (0, _utils.cutPathToRoot)(config.siteRoot || '/', '$1');
    basePath = (0, _utils.cleanSlashes)(config.basePath);
    assetsPath = config.assetsPath || paths.assets || assetsPath;
  }

  var publicPath = "".concat((0, _utils.cleanSlashes)("".concat(siteRoot, "/").concat(basePath), {
    leading: false
  }), "/");

  if (assetsPath && !(0, _utils.isAbsoluteUrl)(assetsPath)) {
    assetsPath = "/".concat((0, _utils.cleanSlashes)("".concat(basePath, "/").concat(assetsPath)), "/");
  } // add trailing slash only if assetsPath was supplied, but no trailing slash


  if (assetsPath && !assetsPath.endsWith('/')) {
    assetsPath = "".concat(assetsPath, "/");
  } // Add the project root as a plugin. This allows the dev
  // to use the plugin api directory in their project if they want


  var plugins = [].concat((0, _toConsumableArray2["default"])(config.plugins || []), [paths.ROOT]); // if (process.env.NODE_ENV !== 'test' && !entry) {
  //   throw new Error(
  //     `Could not resolve entry file from location: ${entry} using extensions: ${(
  //       config.extensions || DEFAULT_EXTENSIONS
  //     ).join(', ')}`
  //   )
  // }
  // Defaults

  config = _objectSpread({
    // Defaults
    getSiteData: function getSiteData() {
      return {};
    },
    prefetchRate: 5,
    maxThreads: Infinity,
    disableRoutePrefixing: false,
    outputFileRate: 100,
    extensions: DEFAULT_EXTENSIONS,
    getRoutes: function () {
      var _getRoutes = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee2() {
        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                return _context2.abrupt("return", DEFAULT_ROUTES);

              case 1:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2);
      }));

      function getRoutes() {
        return _getRoutes.apply(this, arguments);
      }

      return getRoutes;
    }(),
    minLoadTime: 200,
    disablePreload: false,
    disableRuntime: false,
    preloadPollInterval: 300,
    productionSourceMaps: false,
    entry: DEFAULT_ENTRY
  }, config, {
    // Materialized Overrides
    paths: paths,
    plugins: plugins,
    siteRoot: siteRoot,
    basePath: basePath,
    publicPath: publicPath,
    assetsPath: assetsPath,
    extractCssChunks: config.extractCssChunks || false,
    inlineCss: config.inlineCss || false,
    babelExcludes: config.babelExcludes || [],
    devServer: _objectSpread({
      host: 'localhost',
      port: 3000
    }, config.devServer || {})
  });
  config.terser = config.terser || {};
  config.terser.terserOptions = config.terser.terserOptions || {};
  config.terser.terserOptions.mangle = config.terser.terserOptions.mangle || {};
  config.terser.terserOptions.parse = config.terser.terserOptions.parse || {};
  config.terser.terserOptions.compress = config.terser.terserOptions.compress || {};
  config.terser.terserOptions.output = config.terser.terserOptions.output || {}; // Set env variables to be used client side

  process.env.REACT_STATIC_MIN_LOAD_TIME = config.minLoadTime;
  process.env.REACT_STATIC_PREFETCH_RATE = config.prefetchRate;
  process.env.REACT_STATIC_DISABLE_ROUTE_PREFIXING = config.disableRoutePrefixing;
  process.env.REACT_STATIC_DISABLE_PRELOAD = config.disablePreload;
  process.env.REACT_STATIC_DISABLE_RUNTIME = config.disableRuntime;
  process.env.REACT_STATIC_PRELOAD_POLL_INTERVAL = config.preloadPollIntervalw;
  process.env.REACT_STATIC_ROOT_PATH_READ_ONLY = paths.ROOT;
  process.env.REACT_STATIC_TEMPLATES_PATH = _path["default"].join(paths.ARTIFACTS, 'react-static-templates.js');
  process.env.REACT_STATIC_PLUGINS_PATH = _path["default"].join(paths.ARTIFACTS, 'react-static-browser-plugins.js');
  process.env.REACT_STATIC_UNIVERSAL_PATH = require.resolve('react-universal-component');

  var resolvePlugin = function resolvePlugin(originalLocation) {
    var options = {};

    if (Array.isArray(originalLocation)) {
      options = originalLocation[1] || {};
      originalLocation = originalLocation[0];
    }

    var location = [function () {
      // Absolute require
      try {
        var found = require.resolve(originalLocation);

        return found.includes('.') ? _path["default"].resolve(found, '../') : found;
      } catch (err) {//
      }
    }, function () {
      // Absolute
      if (_fsExtra["default"].pathExistsSync(originalLocation)) {
        return originalLocation;
      }
    }, function () {
      // Plugins Dir
      var found = _path["default"].resolve(paths.PLUGINS, originalLocation);

      if (_fsExtra["default"].pathExistsSync(found)) {
        return found;
      }
    }, function () {
      // Plugins Dir require
      try {
        var found = (0, _resolveFrom["default"])(paths.PLUGINS, originalLocation);
        return found.includes('.') ? _path["default"].resolve(found, '../') : found;
      } catch (err) {//
      }
    }, function () {
      // CWD
      var found = _path["default"].resolve(process.cwd(), originalLocation);

      if (_fsExtra["default"].pathExistsSync(found)) {
        return found;
      }
    }, function () {
      // CWD require
      try {
        var found = (0, _resolveFrom["default"])(process.cwd(), originalLocation);
        return found.includes('.') ? _path["default"].resolve(found, '../') : found;
      } catch (err) {//
      }
    }, function () {
      if (process.env.NODE_ENV === 'test') {
        // Allow plugins to be mocked
        return require('path').resolve('./src/static/__mocks__/mock-plugin');
      }
    }].reduce(function (prev, curr) {
      return prev || curr();
    }, null); // TODO: We have to do this because we don't have a good mock for process.cwd() :(

    if (!location) {
      throw new Error("Could not find a plugin directory for the plugin: \"".concat(originalLocation, "\". We must bail!"));
    }

    var nodeLocation = _path["default"].join(location, 'node.api.js');

    var browserLocation = _path["default"].join(location, 'browser.api.js'); // Detect if the node plugin entry exists, and provide the nodeResolver to it


    nodeLocation = _fsExtra["default"].pathExistsSync(nodeLocation) ? nodeLocation : null; // Detect if the browser plugin entry exists, and provide the nodeResolver to it

    browserLocation = _fsExtra["default"].pathExistsSync(browserLocation) ? browserLocation : null;

    var buildPluginHooks = function buildPluginHooks() {
      return {};
    };

    try {
      // Get the hooks for the node api
      if (nodeLocation) {
        buildPluginHooks = require(nodeLocation)["default"];
      } else if (originalLocation !== paths.ROOT && !browserLocation) {
        throw new Error("Could not find a valid node.api.js or browser.api.js plugin file in \"".concat(location, "\". \n") + "The original location: \"".concat(originalLocation, "\". \n") + "The root location: \"".concat(paths.ROOT, "\"."));
      }

      var resolvedPlugin = {
        location: location,
        nodeLocation: nodeLocation,
        browserLocation: browserLocation,
        options: options,
        hooks: buildPluginHooks(options) || {}
      };
      (0, _plugins.validatePlugin)(resolvedPlugin); // Recursively resolve plugins

      if (resolvedPlugin.plugins) {
        resolvedPlugin.plugins = resolvedPlugin.plugins.map(resolvePlugin);
      }

      return resolvedPlugin;
    } catch (err) {
      console.error("The following error occurred in the plugin: \"".concat(originalLocation, "\""));
      throw err;
    }
  };

  state = _objectSpread({}, state, {
    plugins: config.plugins.map(resolvePlugin),
    config: config
  });
  return _plugins["default"].afterGetConfig(state);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zdGF0aWMvZ2V0Q29uZmlnLmpzIl0sIm5hbWVzIjpbImRlZmF1bHRDb25maWciLCJERUZBVUxUX05BTUVfRk9SX1NUQVRJQ19DT05GSUdfRklMRSIsIkRFRkFVTFRfUEFUSF9GT1JfU1RBVElDX0NPTkZJRyIsIm5vZGVQYXRoIiwicmVzb2x2ZSIsImpvaW4iLCJwcm9jZXNzIiwiY3dkIiwiREVGQVVMVF9ST1VURVMiLCJwYXRoIiwiREVGQVVMVF9FTlRSWSIsIkRFRkFVTFRfRVhURU5TSU9OUyIsImdldENvbmZpZyIsInN0YXRlIiwiY2FsbGJhY2siLCJjb25maWciLCJkZWJ1ZyIsImNvbnNvbGUiLCJsb2ciLCJjb25maWdQYXRoIiwicGFja2FnZUNvbmZpZyIsIm9yaWdpbmFsQ29uZmlnIiwicmVzb2x2ZWRQYXRoIiwibm9Db25maWciLCJidWlsZENvbmZpZyIsImJ1aWxkQ29uZmlnRnJvbVBhdGgiLCJzdGFnZSIsImNob2tpZGFyIiwid2F0Y2giLCJpZ25vcmVJbml0aWFsIiwib24iLCJyZXF1aXJlIiwiY2FjaGUiLCJwYXRocyIsInJvb3QiLCJzcmMiLCJkaXN0IiwidGVtcCIsImJ1aWxkQXJ0aWZhY3RzIiwiZGV2RGlzdCIsInBsdWdpbnMiLCJwYWdlcyIsIm5vZGVNb2R1bGVzIiwiYXNzZXRzIiwicmVzb2x2ZVBhdGgiLCJyZWxhdGl2ZVBhdGgiLCJESVNUIiwiZW52IiwiUkVBQ1RfU1RBVElDX0VOViIsIkFTU0VUUyIsIlJPT1QiLCJTUkMiLCJQTFVHSU5TIiwiVEVNUCIsIkFSVElGQUNUUyIsIlBVQkxJQyIsIk5PREVfTU9EVUxFUyIsIkVYQ0xVREVfTU9EVUxFUyIsImV4Y2x1ZGVSZXNvbHZlZE1vZHVsZXMiLCJQQUNLQUdFIiwiSFRNTF9URU1QTEFURSIsIlNUQVRJQ19EQVRBIiwic2l0ZVJvb3QiLCJiYXNlUGF0aCIsImFzc2V0c1BhdGgiLCJkZXZCYXNlUGF0aCIsImRldkFzc2V0c1BhdGgiLCJzdGFnaW5nIiwic3RhZ2luZ1NpdGVSb290Iiwic3RhZ2luZ0Jhc2VQYXRoIiwic3RhZ2luZ0Fzc2V0c1BhdGgiLCJwdWJsaWNQYXRoIiwibGVhZGluZyIsImVuZHNXaXRoIiwiZ2V0U2l0ZURhdGEiLCJwcmVmZXRjaFJhdGUiLCJtYXhUaHJlYWRzIiwiSW5maW5pdHkiLCJkaXNhYmxlUm91dGVQcmVmaXhpbmciLCJvdXRwdXRGaWxlUmF0ZSIsImV4dGVuc2lvbnMiLCJnZXRSb3V0ZXMiLCJtaW5Mb2FkVGltZSIsImRpc2FibGVQcmVsb2FkIiwiZGlzYWJsZVJ1bnRpbWUiLCJwcmVsb2FkUG9sbEludGVydmFsIiwicHJvZHVjdGlvblNvdXJjZU1hcHMiLCJlbnRyeSIsImV4dHJhY3RDc3NDaHVua3MiLCJpbmxpbmVDc3MiLCJiYWJlbEV4Y2x1ZGVzIiwiZGV2U2VydmVyIiwiaG9zdCIsInBvcnQiLCJ0ZXJzZXIiLCJ0ZXJzZXJPcHRpb25zIiwibWFuZ2xlIiwicGFyc2UiLCJjb21wcmVzcyIsIm91dHB1dCIsIlJFQUNUX1NUQVRJQ19NSU5fTE9BRF9USU1FIiwiUkVBQ1RfU1RBVElDX1BSRUZFVENIX1JBVEUiLCJSRUFDVF9TVEFUSUNfRElTQUJMRV9ST1VURV9QUkVGSVhJTkciLCJSRUFDVF9TVEFUSUNfRElTQUJMRV9QUkVMT0FEIiwiUkVBQ1RfU1RBVElDX0RJU0FCTEVfUlVOVElNRSIsIlJFQUNUX1NUQVRJQ19QUkVMT0FEX1BPTExfSU5URVJWQUwiLCJwcmVsb2FkUG9sbEludGVydmFsdyIsIlJFQUNUX1NUQVRJQ19ST09UX1BBVEhfUkVBRF9PTkxZIiwiUkVBQ1RfU1RBVElDX1RFTVBMQVRFU19QQVRIIiwiUkVBQ1RfU1RBVElDX1BMVUdJTlNfUEFUSCIsIlJFQUNUX1NUQVRJQ19VTklWRVJTQUxfUEFUSCIsInJlc29sdmVQbHVnaW4iLCJvcmlnaW5hbExvY2F0aW9uIiwib3B0aW9ucyIsIkFycmF5IiwiaXNBcnJheSIsImxvY2F0aW9uIiwiZm91bmQiLCJpbmNsdWRlcyIsImVyciIsImZzIiwicGF0aEV4aXN0c1N5bmMiLCJOT0RFX0VOViIsInJlZHVjZSIsInByZXYiLCJjdXJyIiwiRXJyb3IiLCJub2RlTG9jYXRpb24iLCJicm93c2VyTG9jYXRpb24iLCJidWlsZFBsdWdpbkhvb2tzIiwicmVzb2x2ZWRQbHVnaW4iLCJob29rcyIsIm1hcCIsImVycm9yIiwiY29yZVBsdWdpbnMiLCJhZnRlckdldENvbmZpZyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7Ozs7O0FBRUE7QUFDQSxJQUFNQSxhQUFhLEdBQUcsRUFBdEI7QUFDQSxJQUFNQyxtQ0FBbUMsR0FBRyxrQkFBNUM7O0FBQ0EsSUFBTUMsOEJBQThCLEdBQUdDLGlCQUFTQyxPQUFULENBQ3JDRCxpQkFBU0UsSUFBVCxDQUFjQyxPQUFPLENBQUNDLEdBQVIsRUFBZCxFQUE2Qk4sbUNBQTdCLENBRHFDLENBQXZDOztBQUdBLElBQU1PLGNBQWMsR0FBRyxDQUFDO0FBQUVDLEVBQUFBLElBQUksRUFBRTtBQUFSLENBQUQsQ0FBdkI7QUFDQSxJQUFNQyxhQUFhLEdBQUcsVUFBdEI7QUFDQSxJQUFNQyxrQkFBa0IsR0FBRyxDQUFDLEtBQUQsRUFBUSxNQUFSLENBQTNCLEMsQ0FFQTs7QUFDZSxTQUFTQyxTQUFULENBQ2JDLEtBRGEsRUFTYjtBQUFBLE1BUEFDLFFBT0EsdUVBUFcsVUFBQUMsTUFBTSxFQUFJO0FBQ25CLFFBQUlGLEtBQUssQ0FBQ0csS0FBVixFQUFpQjtBQUNmQyxNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxjQUFaO0FBQ0FELE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZTCxLQUFaO0FBQ0Q7O0FBQ0QsV0FBT0UsTUFBUDtBQUNELEdBQ0Q7QUFDQSxNQUFNSSxVQUFVLEdBQ2ROLEtBQUssQ0FBQ00sVUFBTixJQUNBTixLQUFLLENBQUNPLGFBQU4sQ0FBb0JMLE1BRHBCLElBRUFiLDhCQUhGO0FBS0FXLEVBQUFBLEtBQUsscUJBQ0FBLEtBREE7QUFFSFEsSUFBQUEsY0FB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QTNCLENBQXpCO0FBQ0Q7O0FBRUQsYUFBT21CLGNBQVA7QUFDRCxLQTVCRCxDQTRCRSxPQUFPWCxHQUFQLEVBQVk7QUFDWnRHLE1BQUFBLE9BQU8sQ0FBQ29ILEtBQVIseURBQ2tEckIsZ0JBRGxEO0FBR0EsWUFBTU8sR0FBTjtBQUNEO0FBQ0YsR0FySEQ7O0FBdUhBMUcsRUFBQUEsS0FBSyxxQkFDQUEsS0FEQTtBQUVIMkIsSUFBQUEsT0FBTyxFQUFFekIsTUFBTSxDQUFDeUIsT0FBUCxDQUFlNEYsR0FBZixDQUFtQnJCLGFBQW5CLENBRk47QUFHSGhHLElBQUFBLE1BQU0sRUFBTkE7QUFIRyxJQUFMO0FBTUEsU0FBT3VILG9CQUFZQyxjQUFaLENBQTJCMUgsS0FBM0IsQ0FBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgaW1wb3J0L25vLWR5bmFtaWMtcmVxdWlyZSAqL1xyXG5cclxuaW1wb3J0IG5vZGVQYXRoIGZyb20gJ3BhdGgnXHJcbmltcG9ydCBjaG9raWRhciBmcm9tICdjaG9raWRhcidcclxuaW1wb3J0IHJlc29sdmVGcm9tIGZyb20gJ3Jlc29sdmUtZnJvbSdcclxuaW1wb3J0IGZzIGZyb20gJ2ZzLWV4dHJhJ1xyXG4vL1xyXG5pbXBvcnQgeyBjbGVhblNsYXNoZXMsIGN1dFBhdGhUb1Jvb3QsIGlzQWJzb2x1dGVVcmwgfSBmcm9tICcuLi91dGlscydcclxuaW1wb3J0IGNvcmVQbHVnaW5zLCB7IHZhbGlkYXRlUGx1Z2luIH0gZnJvbSAnLi9wbHVnaW5zJ1xyXG5cclxuLy8gdGhlIGRlZmF1bHQgc3RhdGljLmNvbmZpZy5qcyBsb2NhdGlvblxyXG5jb25zdCBkZWZhdWx0Q29uZmlnID0ge31cclxuY29uc3QgREVGQVVMVF9OQU1FX0ZPUl9TVEFUSUNfQ09ORklHX0ZJTEUgPSAnc3RhdGljLmNvbmZpZy5qcydcclxuY29uc3QgREVGQVVMVF9QQVRIX0ZPUl9TVEFUSUNfQ09ORklHID0gbm9kZVBhdGgucmVzb2x2ZShcclxuICBub2RlUGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIERFRkFVTFRfTkFNRV9GT1JfU1RBVElDX0NPTkZJR19GSUxFKVxyXG4pXHJcbmNvbnN0IERFRkFVTFRfUk9VVEVTID0gW3sgcGF0aDogJy8nIH1dXHJcbmNvbnN0IERFRkFVTFRfRU5UUlkgPSAnaW5kZXguanMnXHJcbmNvbnN0IERFRkFVTFRfRVhURU5TSU9OUyA9IFsnLmpzJywgJy5qc3gnXVxyXG5cclxuLy8gUmV0cmlldmVzIHRoZSBzdGF0aWMuY29uZmlnLmpzIGZyb20gdGhlIGN1cnJlbnQgcHJvamVjdCBkaXJlY3RvcnlcclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZ2V0Q29uZmlnKFxyXG4gIHN0YXRlLFxyXG4gIGNhbGxiYWNrID0gY29uZmlnID0+IHtcclxuICAgIGlmIChzdGF0ZS5kZWJ1Zykge1xyXG4gICAgICBjb25zb2xlLmxvZygnZ2V0Q29uZmlnKCk6JylcclxuICAgICAgY29uc29sZS5sb2coc3RhdGUpXHJcbiAgICB9XHJcbiAgICByZXR1cm4gY29uZmlnXHJcbiAgfVxyXG4pIHtcclxuICBjb25zdCBjb25maWdQYXRoID1cclxuICAgIHN0YXRlLmNvbmZpZ1BhdGggfHxcclxuICAgIHN0YXRlLnBhY2thZ2VDb25maWcuY29uZmlnIHx8XHJcbiAgICBERUZBVUxUX1BBVEhfRk9SX1NUQVRJQ19DT05GSUdcclxuXHJcbiAgc3RhdGUgPSB7XHJcbiAgICAuLi5zdGF0ZSxcclxuICAgIG9yaWdpbmFsQ29uZmlnOiBjb25maWdQYXRoLFxyXG4gIH1cclxuXHJcbiAgY29uc3QgcmVzb2x2ZWRQYXRoID0gbm9kZVBhdGgucmVzb2x2ZShjb25maWdQYXRoKVxyXG5cclxuICBjb25zdCBub0NvbmZpZyA9XHJcbiAgICBjb25maWdQYXRoID09PSBERUZBVUxUX1BBVEhfRk9SX1NUQVRJQ19DT05GSUcgJiYgIXJlc29sdmVkUGF0aFxyXG5cclxuICBpZiAobm9Db25maWcpIHtcclxuICAgIC8vIGxhc3RcclxuICAgIHN0YXRlID0gYnVpbGRDb25maWcoc3RhdGUsIGRlZmF1bHRDb25maWcpXHJcbiAgICByZXR1cm4gY2FsbGJhY2soc3RhdGUpXHJcbiAgfVxyXG5cclxuICBzdGF0ZSA9IGJ1aWxkQ29uZmlnRnJvbVBhdGgoc3RhdGUsIHJlc29sdmVkUGF0aCB8fCBjb25maWdQYXRoKVxyXG5cclxuICBpZiAoc3RhdGUuc3RhZ2UgPT09ICdkZXYnKSB7XHJcbiAgICBjaG9raWRhclxyXG4gICAgICAud2F0Y2gocmVzb2x2ZWRQYXRoLCB7XHJcbiAgICAgICAgaWdub3JlSW5pdGlhbDogdHJ1ZSxcclxuICAgICAgfSlcclxuICAgICAgLm9uKCdhbGwnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJycpXHJcbiAgICAgICAgY29uc29sZS5sb2coYFVwZGF0aW5nIHN0YXRpYy5jb25maWcuanNgKVxyXG4gICAgICAgIHN0YXRlID0gYnVpbGRDb25maWdGcm9tUGF0aChzdGF0ZSwgcmVzb2x2ZWRQYXRoKVxyXG4gICAgICAgIGNhbGxiYWNrKHN0YXRlKVxyXG4gICAgICB9KVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNhbGxiYWNrKHN0YXRlKVxyXG59XHJcblxyXG5mdW5jdGlvbiBidWlsZENvbmZpZ0Zyb21QYXRoKHN0YXRlLCBjb25maWdQYXRoKSB7XHJcbiAgZGVsZXRlIHJlcXVpcmUuY2FjaGVbY29uZmlnUGF0aF1cclxuICBjb25zdCBjb25maWcgPSByZXF1aXJlKGNvbmZpZ1BhdGgpLmRlZmF1bHRcclxuICByZXR1cm4gYnVpbGRDb25maWcoc3RhdGUsIGNvbmZpZylcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkQ29uZmlnKHN0YXRlLCBjb25maWcgPSB7fSkge1xyXG4gIC8vIERlZmF1bHQgUGF0aHNcclxuICBsZXQgcGF0aHMgPSB7XHJcbiAgICByb290OiBub2RlUGF0aC5yZXNvbHZlKHByb2Nlc3MuY3dkKCkpLFxyXG4gICAgc3JjOiAnc3JjJyxcclxuICAgIGRpc3Q6ICdkaXN0JyxcclxuICAgIHRlbXA6ICd0bXAnLFxyXG4gICAgYnVpbGRBcnRpZmFjdHM6ICdhcnRpZmFjdHMnLFxyXG4gICAgZGV2RGlzdDogJ3RtcC9kZXYtc2VydmVyJyxcclxuICAgIHB1YmxpYzogJ3B1YmxpYycsXHJcbiAgICBwbHVnaW5zOiAncGx1Z2lucycsXHJcbiAgICBwYWdlczogJ3NyYy9wYWdlcycsXHJcbiAgICBub2RlTW9kdWxlczogJ25vZGVfbW9kdWxlcycsXHJcbiAgICBhc3NldHM6ICcnLFxyXG4gICAgLi4uKGNvbmZpZy5wYXRocyB8fCB7fSksXHJcbiAgfVxyXG5cclxuICAvLyBVc2UgdGhlIHJvb3QgdG8gcmVzb2x2ZSBhbGwgb3RoZXIgcmVsYXRpdmUgcGF0aHNcclxuICBjb25zdCByZXNvbHZlUGF0aCA9IHJlbGF0aXZlUGF0aCA9PiBub2RlUGF0aC5yZXNvbHZlKHBhdGhzLnJvb3QsIHJlbGF0aXZlUGF0aClcclxuXHJcbiAgLy8gUmVzb2x2ZSBhbmQgcmVwbGFjZSBhbGwgcGF0aHNzXHJcbiAgY29uc3QgRElTVCA9XHJcbiAgICBwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfRU5WID09PSAnZGV2ZWxvcG1lbnQnXHJcbiAgICAgID8gcmVzb2x2ZVBhdGgocGF0aHMuZGV2RGlzdCB8fCBwYXRocy5kaXN0KVxyXG4gICAgICA6IHJlc29sdmVQYXRoKHBhdGhzLmRpc3QpXHJcbiAgY29uc3QgQVNTRVRTID0gbm9kZVBhdGgucmVzb2x2ZShESVNULCBwYXRocy5hc3NldHMpXHJcblxyXG4gIHBhdGhzID0ge1xyXG4gICAgUk9PVDogcGF0aHMucm9vdCxcclxuICAgIFNSQzogcmVzb2x2ZVBhdGgocGF0aHMuc3JjKSxcclxuICAgIERJU1QsXHJcbiAgICBBU1NFVFMsXHJcbiAgICBQTFVHSU5TOiByZXNvbHZlUGF0aChwYXRocy5wbHVnaW5zKSxcclxuICAgIFRFTVA6IHJlc29sdmVQYXRoKHBhdGhzLnRlbXApLFxyXG4gICAgQVJUSUZBQ1RTOiByZXNvbHZlUGF0aChwYXRocy5idWlsZEFydGlmYWN0cyksXHJcbiAgICBQVUJMSUM6IHJlc29sdmVQYXRoKHBhdGhzLnB1YmxpYyksXHJcbiAgICBOT0RFX01PRFVMRVM6IHJlc29sdmVQYXRoKHBhdGhzLm5vZGVNb2R1bGVzKSxcclxuICAgIEVYQ0xVREVfTU9EVUxFUzpcclxuICAgICAgcGF0aHMuZXhjbHVkZVJlc29sdmVkTW9kdWxlcyB8fCByZXNvbHZlUGF0aChwYXRocy5ub2RlTW9kdWxlcyksXHJcbiAgICBQQUNLQUdFOiByZXNvbHZlUGF0aCgncGFja2FnZS5qc29uJyksXHJcbiAgICBIVE1MX1RFTVBMQVRFOiBub2RlUGF0aC5qb2luKERJU1QsICdpbmRleC5odG1sJyksXHJcbiAgICBTVEFUSUNfREFUQTogbm9kZVBhdGguam9pbihBU1NFVFMsICdzdGF0aWNEYXRhJyksXHJcbiAgfVxyXG5cclxuICAvLyBzaXRlUm9vdCwgYmFzZVBhdGgsIHB1YmxpY1BhdGgsIGFuZCBhc3NldFBhdGggcmVzb2x1dGlvblxyXG4gIGxldCBzaXRlUm9vdCA9ICcnXHJcbiAgbGV0IGJhc2VQYXRoID0gJydcclxuICBsZXQgYXNzZXRzUGF0aCA9ICcnXHJcbiAgaWYgKHByb2Nlc3MuZW52LlJFQUNUX1NUQVRJQ19FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcclxuICAgIGJhc2VQYXRoID0gY2xlYW5TbGFzaGVzKGNvbmZpZy5kZXZCYXNlUGF0aClcclxuICAgIGFzc2V0c1BhdGggPSBjb25maWcuZGV2QXNzZXRzUGF0aCB8fCBwYXRocy5hc3NldHMgfHwgYXNzZXRzUGF0aFxyXG4gIH0gZWxzZSBpZiAoc3RhdGUuc3RhZ2luZykge1xyXG4gICAgc2l0ZVJvb3QgPSBjdXRQYXRoVG9Sb290KGNvbmZpZy5zdGFnaW5nU2l0ZVJvb3QgfHwgJy8nLCAnJDEnKVxyXG4gICAgYmFzZVBhdGggPSBjbGVhblNsYXNoZXMoY29uZmlnLnN0YWdpbmdCYXNlUGF0aClcclxuICAgIGFzc2V0c1BhdGggPSBjb25maWcuc3RhZ2luZ0Fzc2V0c1BhdGggfHwgcGF0aHMuYXNzZXRzIHx8IGFzc2V0c1BhdGhcclxuICB9IGVsc2Uge1xyXG4gICAgc2l0ZVJvb3QgPSBjdXRQYXRoVG9Sb290KGNvbmZpZy5zaXRlUm9vdCB8fCAnLycsICckMScpXHJcbiAgICBiYXNlUGF0aCA9IGNsZWFuU2xhc2hlcyhjb25maWcuYmFzZVBhdGgpXHJcbiAgICBhc3NldHNQYXRoID0gY29uZmlnLmFzc2V0c1BhdGggfHwgcGF0aHMuYXNzZXRzIHx8IGFzc2V0c1BhdGhcclxuICB9XHJcbiAgY29uc3QgcHVibGljUGF0aCA9IGAke2NsZWFuU2xhc2hlcyhgJHtzaXRlUm9vdH0vJHtiYXNlUGF0aH1gLCB7XHJcbiAgICBsZWFkaW5nOiBmYWxzZSxcclxuICB9KX0vYFxyXG5cclxuICBpZiAoYXNzZXRzUGF0aCAmJiAhaXNBYnNvbHV0ZVVybChhc3NldHNQYXRoKSkge1xyXG4gICAgYXNzZXRzUGF0aCA9IGAvJHtjbGVhblNsYXNoZXMoYCR7YmFzZVBhdGh9LyR7YXNzZXRzUGF0aH1gKX0vYFxyXG4gIH1cclxuXHJcbiAgLy8gYWRkIHRyYWlsaW5nIHNsYXNoIG9ubHkgaWYgYXNzZXRzUGF0aCB3YXMgc3VwcGxpZWQsIGJ1dCBubyB0cmFpbGluZyBzbGFzaFxyXG4gIGlmIChhc3NldHNQYXRoICYmICFhc3NldHNQYXRoLmVuZHNXaXRoKCcvJykpIHtcclxuICAgIGFzc2V0c1BhdGggPSBgJHthc3NldHNQYXRofS9gXHJcbiAgfVxyXG5cclxuICAvLyBBZGQgdGhlIHByb2plY3Qgcm9vdCBhcyBhIHBsdWdpbi4gVGhpcyBhbGxvd3MgdGhlIGRldlxyXG4gIC8vIHRvIHVzZSB0aGUgcGx1Z2luIGFwaSBkaXJlY3RvcnkgaW4gdGhlaXIgcHJvamVjdCBpZiB0aGV5IHdhbnRcclxuICBjb25zdCBwbHVnaW5zID0gWy4uLihjb25maWcucGx1Z2lucyB8fCBbXSksIHBhdGhzLlJPT1RdXHJcblxyXG4gIC8vIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Rlc3QnICYmICFlbnRyeSkge1xyXG4gIC8vICAgdGhyb3cgbmV3IEVycm9yKFxyXG4gIC8vICAgICBgQ291bGQgbm90IHJlc29sdmUgZW50cnkgZmlsZSBmcm9tIGxvY2F0aW9uOiAke2VudHJ5fSB1c2luZyBleHRlbnNpb25zOiAkeyhcclxuICAvLyAgICAgICBjb25maWcuZXh0ZW5zaW9ucyB8fCBERUZBVUxUX0VYVEVOU0lPTlNcclxuICAvLyAgICAgKS5qb2luKCcsICcpfWBcclxuICAvLyAgIClcclxuICAvLyB9XHJcblxyXG4gIC8vIERlZmF1bHRzXHJcbiAgY29uZmlnID0ge1xyXG4gICAgLy8gRGVmYXVsdHNcclxuICAgIGdldFNpdGVEYXRhOiAoKSA9PiAoe30pLFxyXG4gICAgcHJlZmV0Y2hSYXRlOiA1LFxyXG4gICAgbWF4VGhyZWFkczogSW5maW5pdHksXHJcbiAgICBkaXNhYmxlUm91dGVQcmVmaXhpbmc6IGZhbHNlLFxyXG4gICAgb3V0cHV0RmlsZVJhdGU6IDEwMCxcclxuICAgIGV4dGVuc2lvbnM6IERFRkFVTFRfRVhURU5TSU9OUyxcclxuICAgIGdldFJvdXRlczogYXN5bmMgKCkgPT4gREVGQVVMVF9ST1VURVMsXHJcbiAgICBtaW5Mb2FkVGltZTogMjAwLFxyXG4gICAgZGlzYWJsZVByZWxvYWQ6IGZhbHNlLFxyXG4gICAgZGlzYWJsZVJ1bnRpbWU6IGZhbHNlLFxyXG4gICAgcHJlbG9hZFBvbGxJbnRlcnZhbDogMzAwLFxyXG4gICAgcHJvZHVjdGlvblNvdXJjZU1hcHM6IGZhbHNlLFxyXG4gICAgZW50cnk6IERFRkFVTFRfRU5UUlksXHJcblxyXG4gICAgLy8gQ29uZmlnIE92ZXJyaWRlc1xyXG4gICAgLi4uY29uZmlnLFxyXG5cclxuICAgIC8vIE1hdGVyaWFsaXplZCBPdmVycmlkZXNcclxuICAgIHBhdGhzLFxyXG4gICAgcGx1Z2lucyxcclxuICAgIHNpdGVSb290LFxyXG4gICAgYmFzZVBhdGgsXHJcbiAgICBwdWJsaWNQYXRoLFxyXG4gICAgYXNzZXRzUGF0aCxcclxuICAgIGV4dHJhY3RDc3NDaHVua3M6IGNvbmZpZy5leHRyYWN0Q3NzQ2h1bmtzIHx8IGZhbHNlLFxyXG4gICAgaW5saW5lQ3NzOiBjb25maWcuaW5saW5lQ3NzIHx8IGZhbHNlLFxyXG4gICAgYmFiZWxFeGNsdWRlczogY29uZmlnLmJhYmVsRXhjbHVkZXMgfHwgW10sXHJcbiAgICBkZXZTZXJ2ZXI6IHtcclxuICAgICAgaG9zdDogJ2xvY2FsaG9zdCcsXHJcbiAgICAgIHBvcnQ6IDMwMDAsXHJcbiAgICAgIC4uLihjb25maWcuZGV2U2VydmVyIHx8IHt9KSxcclxuICAgIH0sXHJcbiAgfVxyXG5cclxuICBjb25maWcudGVyc2VyID0gY29uZmlnLnRlcnNlciB8fCB7fVxyXG4gIGNvbmZpZy50ZXJzZXIudGVyc2VyT3B0aW9ucyA9IGNvbmZpZy50ZXJzZXIudGVyc2VyT3B0aW9ucyB8fCB7fVxyXG4gIGNvbmZpZy50ZXJzZXIudGVyc2VyT3B0aW9ucy5tYW5nbGUgPSBjb25maWcudGVyc2VyLnRlcnNlck9wdGlvbnMubWFuZ2xlIHx8IHt9XHJcbiAgY29uZmlnLnRlcnNlci50ZXJzZXJPcHRpb25zLnBhcnNlID0gY29uZmlnLnRlcnNlci50ZXJzZXJPcHRpb25zLnBhcnNlIHx8IHt9XHJcbiAgY29uZmlnLnRlcnNlci50ZXJzZXJPcHRpb25zLmNvbXByZXNzID1cclxuICAgIGNvbmZpZy50ZXJzZXIudGVyc2VyT3B0aW9ucy5jb21wcmVzcyB8fCB7fVxyXG4gIGNvbmZpZy50ZXJzZXIudGVyc2VyT3B0aW9ucy5vdXRwdXQgPSBjb25maWcudGVyc2VyLnRlcnNlck9wdGlvbnMub3V0cHV0IHx8IHt9XHJcblxyXG4gIC8vIFNldCBlbnYgdmFyaWFibGVzIHRvIGJlIHVzZWQgY2xpZW50IHNpZGVcclxuICBwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfTUlOX0xPQURfVElNRSA9IGNvbmZpZy5taW5Mb2FkVGltZVxyXG4gIHByb2Nlc3MuZW52LlJFQUNUX1NUQVRJQ19QUkVGRVRDSF9SQVRFID0gY29uZmlnLnByZWZldGNoUmF0ZVxyXG4gIHByb2Nlc3MuZW52LlJFQUNUX1NUQVRJQ19ESVNBQkxFX1JPVVRFX1BSRUZJWElORyA9XHJcbiAgICBjb25maWcuZGlzYWJsZVJvdXRlUHJlZml4aW5nXHJcbiAgcHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX0RJU0FCTEVfUFJFTE9BRCA9IGNvbmZpZy5kaXNhYmxlUHJlbG9hZFxyXG4gIHByb2Nlc3MuZW52LlJFQUNUX1NUQVRJQ19ESVNBQkxFX1JVTlRJTUUgPSBjb25maWcuZGlzYWJsZVJ1bnRpbWVcclxuICBwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfUFJFTE9BRF9QT0xMX0lOVEVSVkFMID0gY29uZmlnLnByZWxvYWRQb2xsSW50ZXJ2YWx3XHJcblxyXG4gIHByb2Nlc3MuZW52LlJFQUNUX1NUQVRJQ19ST09UX1BBVEhfUkVBRF9PTkxZID0gcGF0aHMuUk9PVFxyXG5cclxuICBwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfVEVNUExBVEVTX1BBVEggPSBub2RlUGF0aC5qb2luKFxyXG4gICAgcGF0aHMuQVJUSUZBQ1RTLFxyXG4gICAgJ3JlYWN0LXN0YXRpYy10ZW1wbGF0ZXMuanMnXHJcbiAgKVxyXG4gIHByb2Nlc3MuZW52LlJFQUNUX1NUQVRJQ19QTFVHSU5TX1BBVEggPSBub2RlUGF0aC5qb2luKFxyXG4gICAgcGF0aHMuQVJUSUZBQ1RTLFxyXG4gICAgJ3JlYWN0LXN0YXRpYy1icm93c2VyLXBsdWdpbnMuanMnXHJcbiAgKVxyXG4gIHByb2Nlc3MuZW52LlJFQUNUX1NUQVRJQ19VTklWRVJTQUxfUEFUSCA9IHJlcXVpcmUucmVzb2x2ZShcclxuICAgICdyZWFjdC11bml2ZXJzYWwtY29tcG9uZW50J1xyXG4gIClcclxuXHJcbiAgY29uc3QgcmVzb2x2ZVBsdWdpbiA9IG9yaWdpbmFsTG9jYXRpb24gPT4ge1xyXG4gICAgbGV0IG9wdGlvbnMgPSB7fVxyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkob3JpZ2luYWxMb2NhdGlvbikpIHtcclxuICAgICAgb3B0aW9ucyA9IG9yaWdpbmFsTG9jYXRpb25bMV0gfHwge31cclxuICAgICAgb3JpZ2luYWxMb2NhdGlvbiA9IG9yaWdpbmFsTG9jYXRpb25bMF1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBsb2NhdGlvbiA9IFtcclxuICAgICAgKCkgPT4ge1xyXG4gICAgICAgIC8vIEFic29sdXRlIHJlcXVpcmVcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgY29uc3QgZm91bmQgPSByZXF1aXJlLnJlc29sdmUob3JpZ2luYWxMb2NhdGlvbilcclxuICAgICAgICAgIHJldHVybiBmb3VuZC5pbmNsdWRlcygnLicpID8gbm9kZVBhdGgucmVzb2x2ZShmb3VuZCwgJy4uLycpIDogZm91bmRcclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgIC8vXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICAoKSA9PiB7XHJcbiAgICAgICAgLy8gQWJzb2x1dGVcclxuICAgICAgICBpZiAoZnMucGF0aEV4aXN0c1N5bmMob3JpZ2luYWxMb2NhdGlvbikpIHtcclxuICAgICAgICAgIHJldHVybiBvcmlnaW5hbExvY2F0aW9uXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICAoKSA9PiB7XHJcbiAgICAgICAgLy8gUGx1Z2lucyBEaXJcclxuICAgICAgICBjb25zdCBmb3VuZCA9IG5vZGVQYXRoLnJlc29sdmUocGF0aHMuUExVR0lOUywgb3JpZ2luYWxMb2NhdGlvbilcclxuICAgICAgICBpZiAoZnMucGF0aEV4aXN0c1N5bmMoZm91bmQpKSB7XHJcbiAgICAgICAgICByZXR1cm4gZm91bmRcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgICgpID0+IHtcclxuICAgICAgICAvLyBQbHVnaW5zIERpciByZXF1aXJlXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGNvbnN0IGZvdW5kID0gcmVzb2x2ZUZyb20ocGF0aHMuUExVR0lOUywgb3JpZ2luYWxMb2NhdGlvbilcclxuICAgICAgICAgIHJldHVybiBmb3VuZC5pbmNsdWRlcygnLicpID8gbm9kZVBhdGgucmVzb2x2ZShmb3VuZCwgJy4uLycpIDogZm91bmRcclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgIC8vXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICAoKSA9PiB7XHJcbiAgICAgICAgLy8gQ1dEXHJcbiAgICAgICAgY29uc3QgZm91bmQgPSBub2RlUGF0aC5yZXNvbHZlKHByb2Nlc3MuY3dkKCksIG9yaWdpbmFsTG9jYXRpb24pXHJcbiAgICAgICAgaWYgKGZzLnBhdGhFeGlzdHNTeW5jKGZvdW5kKSkge1xyXG4gICAgICAgICAgcmV0dXJuIGZvdW5kXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICAoKSA9PiB7XHJcbiAgICAgICAgLy8gQ1dEIHJlcXVpcmVcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgY29uc3QgZm91bmQgPSByZXNvbHZlRnJvbShwcm9jZXNzLmN3ZCgpLCBvcmlnaW5hbExvY2F0aW9uKVxyXG4gICAgICAgICAgcmV0dXJuIGZvdW5kLmluY2x1ZGVzKCcuJykgPyBub2RlUGF0aC5yZXNvbHZlKGZvdW5kLCAnLi4vJykgOiBmb3VuZFxyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgLy9cclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgICgpID0+IHtcclxuICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0Jykge1xyXG4gICAgICAgICAgLy8gQWxsb3cgcGx1Z2lucyB0byBiZSBtb2NrZWRcclxuICAgICAgICAgIHJldHVybiByZXF1aXJlKCdwYXRoJykucmVzb2x2ZSgnLi9zcmMvc3RhdGljL19fbW9ja3NfXy9tb2NrLXBsdWdpbicpXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgXS5yZWR1Y2UoKHByZXYsIGN1cnIpID0+IHByZXYgfHwgY3VycigpLCBudWxsKVxyXG5cclxuICAgIC8vIFRPRE86IFdlIGhhdmUgdG8gZG8gdGhpcyBiZWNhdXNlIHdlIGRvbid0IGhhdmUgYSBnb29kIG1vY2sgZm9yIHByb2Nlc3MuY3dkKCkgOihcclxuICAgIGlmICghbG9jYXRpb24pIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxyXG4gICAgICAgIGBDb3VsZCBub3QgZmluZCBhIHBsdWdpbiBkaXJlY3RvcnkgZm9yIHRoZSBwbHVnaW46IFwiJHtvcmlnaW5hbExvY2F0aW9ufVwiLiBXZSBtdXN0IGJhaWwhYFxyXG4gICAgICApXHJcbiAgICB9XHJcblxyXG4gICAgbGV0IG5vZGVMb2NhdGlvbiA9IG5vZGVQYXRoLmpvaW4obG9jYXRpb24sICdub2RlLmFwaS5qcycpXHJcbiAgICBsZXQgYnJvd3NlckxvY2F0aW9uID0gbm9kZVBhdGguam9pbihsb2NhdGlvbiwgJ2Jyb3dzZXIuYXBpLmpzJylcclxuXHJcbiAgICAvLyBEZXRlY3QgaWYgdGhlIG5vZGUgcGx1Z2luIGVudHJ5IGV4aXN0cywgYW5kIHByb3ZpZGUgdGhlIG5vZGVSZXNvbHZlciB0byBpdFxyXG4gICAgbm9kZUxvY2F0aW9uID0gZnMucGF0aEV4aXN0c1N5bmMobm9kZUxvY2F0aW9uKSA/IG5vZGVMb2NhdGlvbiA6IG51bGxcclxuXHJcbiAgICAvLyBEZXRlY3QgaWYgdGhlIGJyb3dzZXIgcGx1Z2luIGVudHJ5IGV4aXN0cywgYW5kIHByb3ZpZGUgdGhlIG5vZGVSZXNvbHZlciB0byBpdFxyXG4gICAgYnJvd3NlckxvY2F0aW9uID0gZnMucGF0aEV4aXN0c1N5bmMoYnJvd3NlckxvY2F0aW9uKVxyXG4gICAgICA/IGJyb3dzZXJMb2NhdGlvblxyXG4gICAgICA6IG51bGxcclxuXHJcbiAgICBsZXQgYnVpbGRQbHVnaW5Ib29rcyA9ICgpID0+ICh7fSlcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBHZXQgdGhlIGhvb2tzIGZvciB0aGUgbm9kZSBhcGlcclxuICAgICAgaWYgKG5vZGVMb2NhdGlvbikge1xyXG4gICAgICAgIGJ1aWxkUGx1Z2luSG9va3MgPSByZXF1aXJlKG5vZGVMb2NhdGlvbikuZGVmYXVsdFxyXG4gICAgICB9IGVsc2UgaWYgKG9yaWdpbmFsTG9jYXRpb24gIT09IHBhdGhzLlJPT1QgJiYgIWJyb3dzZXJMb2NhdGlvbikge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcclxuICAgICAgICAgIGBDb3VsZCBub3QgZmluZCBhIHZhbGlkIG5vZGUuYXBpLmpzIG9yIGJyb3dzZXIuYXBpLmpzIHBsdWdpbiBmaWxlIGluIFwiJHtsb2NhdGlvbn1cIi4gXFxuYCArXHJcbiAgICAgICAgICAgIGBUaGUgb3JpZ2luYWwgbG9jYXRpb246IFwiJHtvcmlnaW5hbExvY2F0aW9ufVwiLiBcXG5gICtcclxuICAgICAgICAgICAgYFRoZSByb290IGxvY2F0aW9uOiBcIiR7cGF0aHMuUk9PVH1cIi5gXHJcbiAgICAgICAgKVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCByZXNvbHZlZFBsdWdpbiA9IHtcclxuICAgICAgICBsb2NhdGlvbixcclxuICAgICAgICBub2RlTG9jYXRpb24sXHJcbiAgICAgICAgYnJvd3NlckxvY2F0aW9uLFxyXG4gICAgICAgIG9wdGlvbnMsXHJcbiAgICAgICAgaG9va3M6IGJ1aWxkUGx1Z2luSG9va3Mob3B0aW9ucykgfHwge30sXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHZhbGlkYXRlUGx1Z2luKHJlc29sdmVkUGx1Z2luKVxyXG5cclxuICAgICAgLy8gUmVjdXJzaXZlbHkgcmVzb2x2ZSBwbHVnaW5zXHJcbiAgICAgIGlmIChyZXNvbHZlZFBsdWdpbi5wbHVnaW5zKSB7XHJcbiAgICAgICAgcmVzb2x2ZWRQbHVnaW4ucGx1Z2lucyA9IHJlc29sdmVkUGx1Z2luLnBsdWdpbnMubWFwKHJlc29sdmVQbHVnaW4pXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiByZXNvbHZlZFBsdWdpblxyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXHJcbiAgICAgICAgYFRoZSBmb2xsb3dpbmcgZXJyb3Igb2NjdXJyZWQgaW4gdGhlIHBsdWdpbjogXCIke29yaWdpbmFsTG9jYXRpb259XCJgXHJcbiAgICAgIClcclxuICAgICAgdGhyb3cgZXJyXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzdGF0ZSA9IHtcclxuICAgIC4uLnN0YXRlLFxyXG4gICAgcGx1Z2luczogY29uZmlnLnBsdWdpbnMubWFwKHJlc29sdmVQbHVnaW4pLFxyXG4gICAgY29uZmlnLFxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNvcmVQbHVnaW5zLmFmdGVyR2V0Q29uZmlnKHN0YXRlKVxyXG59XHJcbiJdfQ==